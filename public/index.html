<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta property="og:title" content="tupo.to" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://tupo.to" />
  <title>tupo.to</title>
  <style>
    @import "https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600";@font-face{font-family:'tupoto';src:url(./assets/font/tupoto.eot?93171914);src:url(./assets/font/tupoto.eot?93171914#iefix) format("embedded-opentype"),url(./assets/font/tupoto.woff?93171914) format("woff"),url(./assets/font/tupoto.ttf?93171914) format("truetype"),url(./assets/font/tupoto.svg?93171914#tupoto) format("svg");font-weight:400;font-style:normal}*{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box}body{background:#3d3d3d;font-family:'Source Sans Pro',sans-serif;font-size:16px}.title{margin:2em 0 0;font-weight:400;color:#ededeb;text-align:center;font-size:2em}input{width:100%;padding:0 .6em;height:2em;line-height:2em;color:#ededeb;font-size:1.4em;font-family:inherit;outline:0}button{position:absolute;top:0;right:0;width:4em;height:4em;border:0;cursor:pointer;background-color:#8F62C8;color:#fff;z-index:99}button:before{font-size:20px}button:focus{outline:0}.input_box{padding-bottom:30px;z-index:30;font-size:22px;display:table;overflow:hidden;position:relative}.box:before{transition:.3s;height:0;background-color:#fff;width:100%;z-index:1000;position:absolute;display:block;content:""}.box input{z-index:10;position:relative;font-size:22px;background-color:transparent;border:none;border-bottom:2px solid #fff;padding:5px 11px}.box label{width:100%;padding:0 .6em;height:2em;line-height:2em;color:#fff;transition:.3s;position:absolute;left:0;top:0;font-size:1.4em;z-index:10}.box input:focus ~ label,.-movelabel{left:0!important;opacity:.7;top:43px!important;font-size:76%!important;color:#c3c3c3!important}[class^="icon-"]:before,[class*=" icon-"]:before{font-family:"tupoto";font-style:normal;font-weight:400;speak:none;display:inline-block;text-decoration:inherit;width:1em;margin-right:.2em;text-align:center;font-variant:normal;text-transform:none;line-height:1em;margin-left:.2em;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}.icon-cog:before{content:'\e800'}.icon-clipboard:before{content:'\e801'}.bg_input:before{height:55%!important}.box{position:relative;width:60%;margin:2em auto}.box-foot{font-size:.8em;text-align:center;border-top:1px solid #000;margin-top:10em;padding-top:2em;color:#ccc}.box-foot a{color:#8F62C8}button.-wide{width:auto;}button.-centered{right:50%;
    transform:translateX(50%);}
  </style>
  <script src="//unpkg.com/vue/dist/vue.js"></script>
  <script src="//cdn.jsdelivr.net/npm/vue-resource@1.3.3"></script>
</head>
<body>

  <div id="app">

    <div class="wrapper">

      <header class="box-title">
        <h1 class="title">{{ title }}</h1>
      </header>
      <div class="box box-input">
        <input id="input_url" type="url" required="required" />
        <label for="input_url">{{ longURL }}</label>
        <button type="button" v-on:click="postURL" class="createlink icon icon-cog"></button>
      </div>
      <div class="box box-output">
        <input id="output_url" type="text" />
        <label for="output_url">{{ shortURL }}</label>
        <button type="button" v-on:click="copyURL" class="copytext icon icon-clipboard"></button>
      </div>
      <div class="box box-again">
        <button type="button" v-on:click="clearURL" class="-wide -centered">{{ newURL }}</button>
      </div>
    </div>
    <footer class="box-foot">
      <p>Â©2017 <a href="http://www.devschile.cl/">DevsChile</a>. <a href="https://github.com/lgaticaq/shortener-server">GitHub</a>. Licence: <a href="https://opensource.org/licenses/MIT">MIT</a>.</p>
    </footer>
  </div>

  <script>

    new Vue({
      el: '#app',
      data: {
        title: 'tupo.to | acortador de URL\'s',
        longURL: 'URL larga',
        shortURL: 'URL corta',
        newURL: 'Nueva URL',
        currentSearch: ''
      },
      methods: {
        postURL () {
          const inputURL = document.querySelector('#input_url');
          const outputURL = document.querySelector('#output_url');

          let url = inputURL.value;
          this.currentSearch = url;

          if ( url !== '' && checkUrl(url) && outputURL.value === '') {

            this.$http.post('/', {uri: url}).then(response => {

              this.returnedData = response.body;
              outputURL.value = this.returnedData;
              outputURL.focus();
              outputURL.select();
              this.currentSearch = '';

              }, response => {
                // error callback
            });

          }
        },
        copyURL () {
          const outputURL = document.querySelector('#output_url');
          if (outputURL.value !== '') {
            outputURL.select();
            try {
              var successful = document.execCommand('copy');
              openModal();
            } catch (err) {

            }
          }
        },
        clearURL () {
          const inputURL = document.querySelector('#input_url');
          const outputURL = document.querySelector('#output_url');
          inputURL.value = '';
          outputURL.value = '';
        }
      }
    });

    // Test if a string is an url
    function checkUrl(url) {
      return /^(https?|ftp):\/\/(((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:)*@)?(((\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5])\.(\d|[1-9]\d|1\d\d|2[0-4]\d|25[0-5]))|((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?)(:\d*)?)(\/((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)+(\/(([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)*)*)?)?(\?((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|[\uE000-\uF8FF]|\/|\?)*)?(\#((([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(%[\da-f]{2})|[!\$&'\(\)\*\+,;=]|:|@)|\/|\?)*)?$/i.test(url);
    }

    // custom form behaviour
    var input = document.querySelectorAll('.box input');
    [].forEach.call(input, function(e) {
      e.addEventListener('blur', function(e){
        var siblings = [].filter.call(this.parentElement.children, function(sibling) {
          return sibling != this && sibling.matches('label');
        });
        if (this.value !== "") {
          [].forEach.call(siblings, function(e) {
            e.classList.add('-movelabel');
          });
        } else {
          [].forEach.call(siblings, function(e) {
            e.classList.remove('-movelabel');
          });
        }
      });
    });


  </script>
</body>
</html>
